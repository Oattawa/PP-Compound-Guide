<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PP Compound Property Quick Guide (Automotive) + AI Tools</title>
  <style>
    /* Google Font */
    @import url('https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap');

    /* ===== A4 Print Setup ===== */
    @page { size: A4 portrait; margin: 20mm; }

    :root{
      --bg:#f8f9fa; --text:#333; --muted:#7f8c8d; --line:#dee2e6; --line2:#bdc3c7;
      --brand:#2980b9; --accent:#27ae60; --warn:#e67e22; --violet:#8e44ad; --red:#c0392b;
      --panel:#ffffff; --shadow:0 4px 10px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; padding:20mm; font-family:'Lato',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; font-size:9pt; line-height:1.4; background:var(--bg); color:var(--text);
      -webkit-print-color-adjust:exact; print-color-adjust:exact;}

    .container{width:100%;}
    h1{font-size:18pt; font-weight:700; text-align:center; margin:0 0 5px; color:#2c3e50}
    h2{font-size:12pt; font-weight:400; text-align:center; margin:0 0 25px; color:var(--muted)}

    /* ===== Vertical Tabs Layout ===== */
    .app{display:grid; grid-template-columns: 240px 1fr; gap:16px; align-items:start}
    .v-tabs{background:var(--panel); border:1px solid var(--line); border-radius:10px; padding:10px; box-shadow:var(--shadow); position:sticky; top:10px; max-height:calc(100vh - 40px); overflow:auto}
    .v-tabs h3{margin:6px 8px 10px; font-size:11pt; color:#2c3e50}
    .v-tabs button{display:flex; width:100%; text-align:left; gap:8px; align-items:center;
      padding:10px 12px; margin:6px 0; border:1px solid var(--line); border-radius:10px; background:#fff; color:#2c3e50; cursor:pointer; font-weight:700}
    .v-tabs button:hover{border-color:var(--brand)}
    .v-tabs button.active{background:linear-gradient(180deg,#eef6fd,#ffffff); border-color:#a8c9e6; box-shadow:0 2px 8px rgba(41,128,185,.15)}

    .panels{min-width:0}
    .panel{display:none; background:var(--panel); border:1px solid var(--line); border-radius:10px; box-shadow:var(--shadow); padding:16px}
    .panel.active{display:block}

    /* ===== Tables ===== */
    table{width:100%; border-collapse:collapse; table-layout:fixed}
    th,td{border:1px solid var(--line2); padding:8px; text-align:left; word-wrap:break-word}
    thead th{background:var(--brand); color:#fff; font-weight:700; text-align:center}
    tbody tr:nth-child(even){background:#ecf0f1}
    tbody tr:nth-child(odd){background:#fff}
    .num-data{text-align:center}

    /* ===== Feature sections reused styles ===== */
    .feature-section{margin-top:0}
    .feature-section h3{margin-top:0; font-size:14pt; border-bottom:2px solid #ecf0f1; padding-bottom:10px; margin-bottom:12px}
    .ai-advisor-title{color:var(--accent)}
    .level-checker-title{color:var(--warn)}
    .estimator-title{color:var(--violet)}
    .comparator-title{color:var(--red)}

    .input-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:16px}
    .input-row{display:flex; align-items:center; gap:10px; flex-wrap:wrap; margin-top:8px}
    .input-column h4{margin:0 0 8px; color:#34495e; border-bottom:1px solid #ecf0f1; padding-bottom:6px}
    .input-group{margin-bottom:12px}
    .input-group label{display:block; margin-bottom:6px; font-weight:700; color:#34495e}
    .input-group input,.input-group select,#prompt-input{width:100%; padding:10px; border-radius:6px; border:1px solid var(--line2); font-size:10pt; background:#fff}
    #prompt-input{resize:vertical; margin-bottom:10px}

    .action-button{display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 14px; border:none; border-radius:8px; color:#fff; font-weight:700; cursor:pointer; margin:8px 6px 0 0}
    #gemini-button{background:var(--accent)}
    #gemini-button:hover{filter:brightness(1.08)}
    #checker-button{background:#e67e22}
    #estimator-button{background:var(--violet)}
    #processing-tips-button{background:#3498db; display:none}
    #comparator-button{background:var(--red)}

    .loader{display:none; text-align:center; margin-top:12px}

    .result-area{margin-top:14px; padding:12px; border-radius:6px; background:#f8f9fa; border:1px solid #e9ecef; min-height:50px; overflow:auto}
    .result-table{margin-top:10px}
    .result-table td:first-child{font-weight:700; color:#34495e}
    .result-table td:not(:first-child){text-align:center; font-weight:700}
    .price-row td{background:#fcf3cf !important}

    .level{font-weight:700; padding:2px 6px; border-radius:4px; color:#fff}
    .level-low{background:#3498db}
    .level-medium{background:#f1c40f; color:#333}
    .level-high{background:#e74c3c}

    .hint{color:var(--muted); font-size:.9em}
    .badge{display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px; font-weight:700; font-size:.8em; border:1px solid var(--line2)}
    .badge.verified{background:#eaf7ef; color:#166b38; border-color:#bfe6cb}

    /* Print: show only Quick Guide (panel-guide) */
    @media print{ .v-tabs, #panel-advisor, #panel-checker, #panel-estimator, #panel-comparator, #panel-standards { display:none !important } #panel-guide{ display:block !important; border:none; box-shadow:none } body{padding:0} }

    /* Small screens: switch to top tab bar */
    @media (max-width:720px){
      .app{ grid-template-columns: 1fr; gap: 10px; }
      .v-tabs{
        display:flex; flex-direction:row; gap:8px;
        position:sticky; top:0; z-index:10;
        max-height:none; overflow-x:auto; overflow-y:hidden;
        padding:8px; border-radius:999px; background:#fff;
      }
      .v-tabs h3{ display:none; }
      .v-tabs button{
        flex:0 0 auto; margin:0; text-align:center; border-radius:999px; padding:10px 12px;
      }
      .v-tabs button.active{ background:linear-gradient(180deg,#eef6fd,#ffffff); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>PP Compound Property Quick Guide</h1>
    <h2>Automotive Reference for Ranges &amp; Significant Gaps</h2>

    <div class="app">
      <nav class="v-tabs" aria-label="Sections">
        <h3>Sections</h3>
        <button class="active" data-tab="guide">üìö Quick Guide</button>
        <button data-tab="standards">üìè Standards &amp; OEM Temps</button>
        <button data-tab="advisor">‚ú® AI Material Advisor</button>
        <button data-tab="checker">üìä Property Level Checker</button>
        <button data-tab="estimator">üî¨ AI Property &amp; Process Estimator</button>
        <button data-tab="comparator">‚öñÔ∏è A/B Material Comparator</button>
      </nav>

      <div class="panels">
        <!-- ===== Quick Guide Panel ===== -->
        <section id="panel-guide" class="panel active">
          <div class="feature-section">
            <h3 class="ai-advisor-title" style="color:#2c3e50">Reference Table</h3>
            <table>
              <thead>
                <tr>
                  <th>Property</th>
                  <th>Low</th>
                  <th>Medium</th>
                  <th>High</th>
                  <th>Significant Gap</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>SG ‚Üí % Filler</td><td class="num-data">&lt;1.00</td><td class="num-data">1.00‚Äì1.20</td><td class="num-data">&gt;1.20</td><td class="num-data">‚â•0.05 SG (~3% filler)</td></tr>
                <tr><td>Tensile Strength (MPa)</td><td class="num-data">&lt;25</td><td class="num-data">25‚Äì45</td><td class="num-data">&gt;45</td><td class="num-data">‚â•5 MPa</td></tr>
                <tr><td>Tensile Modulus (MPa)</td><td class="num-data">&lt;1,500</td><td class="num-data">1,500‚Äì3,500</td><td class="num-data">&gt;3,500</td><td class="num-data">‚â•300 MPa</td></tr>
                <tr><td>Flexural Strength (MPa)</td><td class="num-data">&lt;40</td><td class="num-data">40‚Äì70</td><td class="num-data">&gt;70</td><td class="num-data">‚â•5 MPa</td></tr>
                <tr><td>Flexural Modulus (MPa)</td><td class="num-data">&lt;1,500</td><td class="num-data">1,500‚Äì4,000</td><td class="num-data">&gt;4,000</td><td class="num-data">‚â•300 MPa</td></tr>
                <tr><td>Izod Impact RT (J/m, notched)</td><td class="num-data">&lt;50</td><td class="num-data">50‚Äì200</td><td class="num-data">&gt;200</td><td class="num-data">‚â•20 J/m</td></tr>
                <tr><td>Izod Impact ‚àí30¬∞C (J/m, notched)</td><td class="num-data">&lt;20</td><td class="num-data">20‚Äì100</td><td class="num-data">&gt;100</td><td class="num-data">‚â•10 J/m</td></tr>
                <tr><td>Charpy Impact RT (kJ/m¬≤, notched)</td><td class="num-data">&lt;0.5</td><td class="num-data">0.5‚Äì2.0</td><td class="num-data">&gt;2.0</td><td class="num-data">‚â•0.2 kJ/m¬≤</td></tr>
                <tr><td>Charpy Impact ‚àí30¬∞C (kJ/m¬≤, notched)</td><td class="num-data">&lt;0.3</td><td class="num-data">0.3‚Äì1.0</td><td class="num-data">&gt;1.0</td><td class="num-data">‚â•0.1 kJ/m¬≤</td></tr>
                <tr><td>MFR (g/10 min, 230¬∞C/2.16 kg)</td><td class="num-data">&lt;5</td><td class="num-data">5‚Äì20</td><td class="num-data">&gt;20</td><td class="num-data">‚â•3 g/10 min</td></tr>
                <tr><td>HDT @1.8 MPa (¬∞C)</td><td class="num-data">&lt;80</td><td class="num-data">80‚Äì110</td><td class="num-data">&gt;110</td><td class="num-data">‚â•5¬∞C</td></tr>
              </tbody>
            </table>
            <p class="hint" style="margin-top:8px">Note: Izod (ASTM D256, J/m) and Charpy (ISO 179, kJ/m¬≤) use different geometries. For a quick sanity check you can use <strong>Charpy kJ/m¬≤ ‚âà Izod J/m √∑ 100</strong> for standard 10&nbsp;mm width notched specimens; actual conversion depends on specimen &amp; notch.</p>
          </div>
        </section>

        <!-- ===== Standards Panel ===== -->
        <section id="panel-standards" class="panel">
          <div class="feature-section">
            <h3 class="ai-advisor-title" style="color:#2c3e50">Automotive Test Standards &amp; OEM Impact Temperatures</h3>

            <h4 style="margin:6px 0 8px; color:#34495e">Impact Test Standards (Common)</h4>
            <table>
              <thead>
                <tr>
                  <th>Method</th>
                  <th>Standard</th>
                  <th>Notch / Type</th>
                  <th>Specimen (typ.)</th>
                  <th>Units</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Izod (notched)</td>
                  <td>ASTM D256</td>
                  <td>V-notch (A)</td>
                  <td>~64√ó12.7√ó3.2&nbsp;mm</td>
                  <td>J/m</td>
                  <td>Auto labs often use 3.2‚Äì4&nbsp;mm; keep geometry consistent.</td>
                </tr>
                <tr>
                  <td>Izod (notched)</td>
                  <td>ISO 180/1A</td>
                  <td>A-notch</td>
                  <td>80√ó10√ó4&nbsp;mm</td>
                  <td>kJ/m¬≤</td>
                  <td>Do not mix with ASTM values without conversion.</td>
                </tr>
                <tr>
                  <td>Charpy (notched)</td>
                  <td>ISO 179-1eA</td>
                  <td>V-notch</td>
                  <td>80√ó10√ó4&nbsp;mm</td>
                  <td>kJ/m¬≤</td>
                  <td>Basis used by many EU OEMs for exterior parts.</td>
                </tr>
                <tr>
                  <td>Charpy (unnotched)</td>
                  <td>ISO 179-1eU</td>
                  <td>Unnotched</td>
                  <td>80√ó10√ó4&nbsp;mm</td>
                  <td>kJ/m¬≤</td>
                  <td>Significantly higher than notched; not directly comparable.</td>
                </tr>
              </tbody>
            </table>
            <p class="hint" style="margin-top:8px">Quick check: <strong>Charpy (kJ/m¬≤) ‚âà Izod (J/m) √∑ 100</strong> for standard <em>notched</em> bars; confirm geometry &amp; notch before comparing.</p>

            <h4 style="margin:14px 0 8px; color:#34495e">OEM Impact Temperature Checklist</h4>
            <table id="oem-temp-table">
              <thead>
                <tr>
                  <th>OEM / Domain</th>
                  <th>Method</th>
                  <th>Typical Setpoints (¬∞C)</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody contenteditable="true">
                <tr>
                  <td>Generic ‚Äî Exterior (fascia/bumper)</td>
                  <td>Notched Izod / Charpy</td>
                  <td>23, -30</td>
                  <td>Common cold-impact pair; verify in program spec.</td>
                </tr>
                <tr>
                  <td>Generic ‚Äî Interior</td>
                  <td>Notched Izod / Charpy</td>
                  <td>23, -20</td>
                  <td>Some OEMs also require -30&nbsp;¬∞C for critical interior parts.</td>
                </tr>
                <tr>
                  <td>OEM (enter)</td>
                  <td>‚Äî</td>
                  <td>‚Äî</td>
                  <td>Replace with the exact WSS/GMW/TL/TSM/HES/ES clause.</td>
                </tr>
              </tbody>
            </table>
            <p class="hint" style="margin-top:8px">Cells above are editable. Paste OEM clauses or temps here to track per-program requirements. This app uses <strong>notched</strong> impact values throughout.</p>
          </div>
        </section>

        <!-- ===== AI Advisor Panel ===== -->
        <section id="panel-advisor" class="panel">
          <div class="feature-section">
            <h3 class="ai-advisor-title">‚ú® AI Material Advisor</h3>
            <p>Describe your application needs and get an AI-powered material suggestion.</p>
            <textarea id="prompt-input" rows="4" placeholder="e.g., a car bumper that needs high impact resistance and good stiffness..."></textarea>
            <button id="gemini-button" class="action-button">Get Suggestion</button>
            <div id="gemini-loader" class="loader">Getting suggestion...</div>
            <div id="gemini-result" class="result-area"></div>
          </div>
        </section>

        <!-- ===== Level Checker Panel ===== -->
        <section id="panel-checker" class="panel">
          <div class="feature-section">
            <h3 class="level-checker-title">üìä Property Level Checker</h3>
            <p>Select a property and enter a value to see its performance level.</p>
            <div class="input-group">
              <label for="property-select">Select Property</label>
              <select id="property-select">
                <option value="fillerContent">Filler Content (%)</option>
                <option value="tensileStrength">Tensile Strength (MPa)</option>
                <option value="tensileModulus">Tensile Modulus (MPa)</option>
                <option value="flexuralStrength">Flexural Strength (MPa)</option>
                <option value="flexuralModulus">Flexural Modulus (MPa)</option>
                <option value="izodImpactRT">Izod Impact RT (J/m, notched)</option>
                <option value="izodImpactN30">Izod Impact ‚àí30¬∞C (J/m, notched)</option>
                <option value="charpyImpactRT">Charpy Impact RT (kJ/m¬≤, notched)</option>
                <option value="mfr">MFR (g/10 min)</option>
                <option value="hdt">HDT @1.8 MPa (¬∞C)</option>
              </select>
            </div>
            <div class="input-group">
              <label for="property-value-input" id="property-value-label">Enter Value</label>
              <input type="number" id="property-value-input" placeholder="e.g., 150" />
            </div>
            <button id="checker-button" class="action-button">Check Level</button>
            <div id="checker-result" class="result-area"></div>
          </div>
        </section>

        <!-- ===== Estimator Panel ===== -->
        <section id="panel-estimator" class="panel">
          <div class="feature-section">
            <h3 class="estimator-title">üî¨ AI Property &amp; Process Estimator</h3>
            <p>Select a composition to estimate its typical property profile and price index. You can use <span class="badge verified">Verified data</span> (literature-backed) or AI.</p>
            <div class="input-grid">
              <div class="input-group">
                <label for="pp-type-select">PP Type</label>
                <select id="pp-type-select">
                  <option value="homo">PP Homo</option>
                  <option value="copo">PP Copo</option>
                </select>
              </div>
              <div class="input-group">
                <label for="filler-type-select">Filler Type</label>
                <select id="filler-type-select">
                  <option value="none">None</option>
                  <option value="talc">Talc</option>
                  <option value="sgf">Short Glass Fiber (SGF)</option>
                  <option value="lgf">Long Glass Fiber (LGF)</option>
                  <option value="caco3">Calcium Carbonate</option>
                  <option value="mica">Mica</option>
                </select>
              </div>
              <div class="input-group">
                <label for="filler-content-input">Filler Content (%)</label>
                <input type="number" id="filler-content-input" placeholder="e.g., 20" value="0" />
              </div>
              <div class="input-group">
                <label for="rubber-content-input">Rubber Content (%)</label>
                <input type="number" id="rubber-content-input" placeholder="e.g., 10" value="0" />
              </div>
            </div>
            <div class="input-row">
              <label class="hint"><input type="checkbox" id="use-verified" /> Use Verified Data (no AI)</label>
            </div>
            <p class="hint">Impact values are for <strong>notched</strong> specimens (Izod: ASTM D256, J/m; Charpy: ISO 179, kJ/m¬≤).</p>
            <button id="estimator-button" class="action-button">Estimate Properties &amp; Price</button>
            <div id="estimator-loader" class="loader">Estimating...</div>
            <div id="estimator-result" class="result-area"></div>
            <button id="processing-tips-button" class="action-button">‚ú® Get AI Processing Tips</button>
            <div id="processing-loader" class="loader">Getting processing tips...</div>
            <div id="processing-result" class="result-area" style="display:none"></div>
          </div>
        </section>

        <!-- ===== Comparator Panel ===== -->
        <section id="panel-comparator" class="panel">
          <div class="feature-section">
            <h3 class="comparator-title">‚öñÔ∏è A/B Material Comparator</h3>
            <p>Directly compare two formulations. Toggle <span class="badge verified">Verified data</span> in the Estimator to apply here too.</p>
            <div class="input-grid">
              <div class="input-column">
                <h4>Material A</h4>
                <div class="input-group"><label for="a-pp-type">PP Type</label><select id="a-pp-type"><option value="homo">PP Homo</option><option value="copo" selected>PP Copo</option></select></div>
                <div class="input-group"><label for="a-filler-type">Filler Type</label><select id="a-filler-type"><option value="none">None</option><option value="talc" selected>Talc</option><option value="sgf">SGF</option><option value="lgf">LGF</option><option value="caco3">CaCO‚ÇÉ</option><option value="mica">Mica</option></select></div>
                <div class="input-group"><label for="a-filler-content">Filler Content (%)</label><input type="number" id="a-filler-content" value="20" /></div>
                <div class="input-group"><label for="a-rubber-content">Rubber Content (%)</label><input type="number" id="a-rubber-content" value="10" /></div>
              </div>
              <div class="input-column">
                <h4>Material B</h4>
                <div class="input-group"><label for="b-pp-type">PP Type</label><select id="b-pp-type"><option value="homo">PP Homo</option><option value="copo" selected>PP Copo</option></select></div>
                <div class="input-group"><label for="b-filler-type">Filler Type</label><select id="b-filler-type"><option value="none">None</option><option value="talc">Talc</option><option value="sgf" selected>SGF</option><option value="lgf">LGF</option><option value="caco3">CaCO‚ÇÉ</option><option value="mica">Mica</option></select></div>
                <div class="input-group"><label for="b-filler-content">Filler Content (%)</label><input type="number" id="b-filler-content" value="20" /></div>
                <div class="input-group"><label for="b-rubber-content">Rubber Content (%)</label><input type="number" id="b-rubber-content" value="5" /></div>
              </div>
            </div>
            <p class="hint">Impact values are for <strong>notched</strong> specimens (consistent with the Estimator).</p>
            <button id="comparator-button" class="action-button">Compare Materials</button>
            <div id="comparator-loader" class="loader">Comparing...</div>
            <div id="comparator-result" class="result-area"></div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <script>
    // ===== Vertical Tabs Script =====
    (function(){
      var btns = document.querySelectorAll('.v-tabs button');
      var panels = {
        guide: document.getElementById('panel-guide'),
        standards: document.getElementById('panel-standards'),
        advisor: document.getElementById('panel-advisor'),
        checker: document.getElementById('panel-checker'),
        estimator: document.getElementById('panel-estimator'),
        comparator: document.getElementById('panel-comparator')
      };
      function activate(tab){
        for(var k in panels){ if(panels[k]) panels[k].classList.remove('active'); }
        if(panels[tab]) panels[tab].classList.add('active');
        btns.forEach(function(b){ b.classList.toggle('active', b.getAttribute('data-tab')===tab); });
      }
      btns.forEach(function(b){ b.addEventListener('click', function(){ activate(this.getAttribute('data-tab')); }); });
    })();

    // ===== Gemini API helper (with graceful fallback) =====
    async function callGemini(prompt, schema){
      if(schema===undefined) schema = null;
      var apiKey = ""; // Add restricted API key or use proxy. Empty = fallback.
      if(!apiKey){ throw new Error('No API key configured. Using local heuristic fallback.'); }
      var url = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=' + apiKey;
      var payload = { contents:[{ role:'user', parts:[{ text: prompt }]}] };
      if(schema){ payload.generationConfig = { responseMimeType:'application/json', responseSchema:schema }; }
      var res = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
      if(!res.ok){ throw new Error('API error: ' + res.status); }
      var data = await res.json();
      return (data && data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0] && data.candidates[0].content.parts[0].text) ? data.candidates[0].content.parts[0].text : '';
    }

    // ===== Property Level Checker =====
    var checkerButton = document.getElementById('checker-button');
    var propertySelect = document.getElementById('property-select');
    var propertyValueInput = document.getElementById('property-value-input');
    var checkerResultDiv = document.getElementById('checker-result');
    checkerButton.addEventListener('click', function(){
      var key = propertySelect.value; var label = propertySelect.options[propertySelect.selectedIndex].text; var v = parseFloat(propertyValueInput.value);
      if(isNaN(v)){ checkerResultDiv.innerHTML = '<p>Please enter a valid number.</p>'; return; }
      var bandsMap = {
        fillerContent:{ low:1.00, med:1.20, isSg:true },
        tensileStrength:{ low:25, med:45 },
        tensileModulus:{ low:1500, med:3500 },
        flexuralStrength:{ low:40, med:70 },
        flexuralModulus:{ low:1500, med:4000 },
        izodImpactRT:{ low:50, med:200 },
        izodImpactN30:{ low:20, med:100 },
        charpyImpactRT:{ low:0.5, med:2.0 },
        mfr:{ low:5, med:20 },
        hdt:{ low:80, med:110 }
      };
      var bands = bandsMap[key];
      var valueDisp = v, compare = v;
      if(bands && bands.isSg){ compare = 0.91 + (v * 0.009); valueDisp = v + '% (Approx. SG ' + compare.toFixed(2) + ')'; }
      var level='high', cls='level-high'; if(bands && compare < bands.low){ level='low'; cls='level-low'; } else if(bands && compare <= bands.med){ level='medium'; cls='level-medium'; }
      checkerResultDiv.innerHTML = '<p>' + label + ' of <strong>' + valueDisp + '</strong> is: <span class="level ' + cls + '">' + level.toUpperCase() + '</span></p>';
    });

    // ===== Evidence-backed database (literature & datasheets, normalized to NOTCHED tests) =====
    // Units: MPa (strength), GPa (flexural modulus), J/m (Izod), kJ/m¬≤ (Charpy RT), ¬∞C (HDT @1.8 MPa), g/10 min (MFR @230¬∞C/2.16 kg)
    var EVIDENCE_DB = {
      none: { 0: { tensile:[28,37], flexMod:[1.2,1.7], izodRT:[40,120], izodN30:[5,25], charpyRT:[0.3,1.0], hdt:[60,70], mfr:[12,25] }},
      talc: {
        10: { tensile:[30,35], flexMod:[1.6,2.0], izodRT:[40,120], izodN30:[15,60], charpyRT:[0.5,1.5], hdt:[70,80], mfr:[8,16] },
        20: { tensile:[28,34], flexMod:[2.0,2.4], izodRT:[30,80],  izodN30:[10,40], charpyRT:[0.3,0.8], hdt:[75,85], mfr:[5,12] },
        30: { tensile:[24,32], flexMod:[2.6,3.2], izodRT:[20,60],  izodN30:[8,30],  charpyRT:[0.25,0.7], hdt:[78,90], mfr:[3,8] },
        40: { tensile:[22,30], flexMod:[3.4,4.0], izodRT:[15,50],  izodN30:[5,25],  charpyRT:[0.2,0.6], hdt:[80,95], mfr:[2,6] }
      },
      caco3: {
        20: { tensile:[24,28], flexMod:[1.8,2.2], izodRT:[40,80],  izodN30:[15,50], charpyRT:[0.4,1.0], hdt:[65,75], mfr:[6,14] },
        30: { tensile:[22,27], flexMod:[2.1,2.6], izodRT:[35,70],  izodN30:[12,45], charpyRT:[0.35,0.9], hdt:[66,78], mfr:[4,10] }
      },
      mica: {
        20: { tensile:[26,34], flexMod:[2.5,3.2], izodRT:[40,90],  izodN30:[15,45], charpyRT:[0.4,1.0], hdt:[90,110], mfr:[4,10] },
        40: { tensile:[30,45], flexMod:[4.0,4.8], izodRT:[30,70],  izodN30:[12,35], charpyRT:[0.3,0.8], hdt:[110,130], mfr:[2,6] }
      },
      sgf: {
        20: { tensile:[50,70], flexMod:[3.5,4.2], izodRT:[70,120], izodN30:[40,80], charpyRT:[0.7,1.3], hdt:[110,130], mfr:[3,10] },
        30: { tensile:[80,95], flexMod:[6.0,6.6], izodRT:[90,140], izodN30:[60,110], charpyRT:[0.9,1.5], hdt:[140,155], mfr:[2,6] },
        40: { tensile:[95,105],flexMod:[8.0,10.0],izodRT:[100,160],izodN30:[70,120], charpyRT:[1.0,1.7], hdt:[150,165], mfr:[1,4] }
      },
      lgf: {
        30: { tensile:[80,90], flexMod:[6.0,7.0], izodRT:[130,260], izodN30:[90,180], charpyRT:[1.0,2.5], hdt:[140,155], mfr:[2,6] },
        40: { tensile:[90,100],flexMod:[7.0,8.0], izodRT:[160,300], izodN30:[110,220], charpyRT:[1.2,3.0], hdt:[145,160], mfr:[1,4] }
      }
    };

    function nearestBucket(type, pct){
      var keys = Object.keys(EVIDENCE_DB[type]||{}).map(function(k){ return +k; }).sort(function(a,b){ return a-b; });
      if(!keys.length) return null;
      var best=keys[0], d=Infinity; for(var i=0;i<keys.length;i++){ var k=keys[i]; var diff=Math.abs(pct-k); if(diff<d){ d=diff; best=k; } }
      return best;
    }

    function scaleRange(pair, factor){ return [pair[0]*factor, pair[1]*factor]; }
    function addRange(pair, delta){ return [pair[0]+delta, pair[1]+delta]; }

    function adjustForPPAndRubber(base, ppType, rPct){
      var isCopo = (ppType||'homo').toLowerCase()==='copo';
      var s = { tensile: isCopo?0.92:1.0, flex: isCopo?0.96:1.0, izod: isCopo?1.6:1.0, hdtAdd: isCopo?-5:0, mfrAdd: isCopo?-2:0 };
      var r = { tensile: Math.max(0.5, 1 - 0.015*rPct), flex: Math.max(0.4, 1 - 0.02*rPct), izod: 1 + 0.06*rPct, hdtAdd: -0.6*rPct, mfrAdd: -0.25*rPct };
      var out = JSON.parse(JSON.stringify(base));
      out.tensile = scaleRange(out.tensile, s.tensile*r.tensile);
      out.flexMod = scaleRange(out.flexMod, s.flex*r.flex);
      out.izodRT   = scaleRange(out.izodRT,   s.izod*r.izod);
      out.izodN30  = scaleRange(out.izodN30||out.izodRT, s.izod*(1.1)*r.izod);
      out.charpyRT = scaleRange(out.charpyRT, s.izod*r.izod);
      out.hdt      = addRange(out.hdt, s.hdtAdd + r.hdtAdd);
      out.mfr      = addRange(out.mfr, s.mfrAdd + r.mfrAdd);
      return out;
    }

    function formatRange(pair, unit, decimals){
      if(decimals===undefined) decimals=0;
      var lo = pair[0], hi = pair[1];
      var f = function(x){ return x.toFixed(decimals); };
      return f(lo) + '‚Äì' + f(hi) + unit;
    }

    function evidenceEstimate(ppType, fillerType, fPct, rPct){
      fillerType=(fillerType||'none').toLowerCase();
      if(fillerType==='none') fPct=0;
      var typeDB = EVIDENCE_DB[fillerType];
      if(!typeDB){ return null; }
      var bucket = nearestBucket(fillerType, fPct);
      if(bucket===null){ return null; }
      var base = typeDB[bucket];
      var adj = adjustForPPAndRubber(base, ppType, rPct);
      // Convert flexMod GPa -> MPa for display, and estimate tensile modulus ~0.8√ó flex modulus as a rule of thumb
      var flexMPa = [adj.flexMod[0]*1000, adj.flexMod[1]*1000];
      var tensMod = [flexMPa[0]*0.8, flexMPa[1]*0.8];
      return {
        tensileStrength: formatRange(adj.tensile, ' MPa', 0),
        tensileModulus:  formatRange(tensMod, ' MPa', 0),
        flexuralStrength: '‚Äî',
        flexuralModulus: formatRange(flexMPa, ' MPa', 0),
        izodImpactRT:    formatRange(adj.izodRT, ' J/m', 0),
        izodImpactN30:   formatRange(adj.izodN30, ' J/m', 0),
        charpyImpactRT:  formatRange(adj.charpyRT, ' kJ/m¬≤', 1),
        hdt:             formatRange(adj.hdt, '¬∞C', 0),
        mfr:             formatRange([Math.max(0.5, adj.mfr[0]), Math.max(0.6, adj.mfr[1])], ' g/10 min', 1),
        _badge: '<span class="badge verified">Verified data</span> (bucket: ' + fillerType.toUpperCase() + ' ' + bucket + '%)'
      };
    }

    // ===== Heuristic Estimator (fallback) =====
    var BASE = { tensile:{homo:30, copo:28}, flex:{homo:50,copo:48}, izod:{homo:80,copo:140}, hdt:{homo:95,copo:90} };
    var FILL = { none:{t:0,f:0,i:0,h:0}, talc:{t:0.6,f:1.0,i:-3,h:0.8}, sgf:{t:1.2,f:1.8,i:-1.0,h:0.7}, lgf:{t:1.6,f:2.4,i:-0.5,h:0.9}, caco3:{t:0.4,f:0.7,i:-2,h:0.5}, mica:{t:0.8,f:1.6,i:-2,h:1.2} };
    var RUB = { t:-0.5, f:-0.8, i:4, h:-0.6 };
    function clamp(v,a,b){ return Math.min(b, Math.max(a,v)); }
    function band(m,p){ return [m*(1-p), m*(1+p)]; }

    function heuristicEstimate(ppType, fillerType, fPct, rPct){
      ppType = (ppType||'homo').toLowerCase(); fillerType=(fillerType||'none').toLowerCase(); fPct=+fPct||0; rPct=+rPct||0;
      var t=BASE.tensile[ppType], f=BASE.flex[ppType], i=BASE.izod[ppType], h=BASE.hdt[ppType];
      var E=FILL[fillerType]; t+=E.t*fPct; f+=E.f*fPct; i+=E.i*fPct; h+=E.h*fPct; t+=RUB.t*rPct; f+=RUB.f*rPct; i+=RUB.i*rPct; h+=RUB.h*rPct;
      // Izod notched cap by filler type (keeps results realistic)
      var IZOD_MAX = { none:600, talc:220, caco3:240, mica:220, sgf:180, lgf:220 };
      i = Math.min(i, IZOD_MAX[fillerType] || 400);
      // MFR heuristic (g/10 min @230¬∞C/2.16 kg)
      var BASE_MFR = { homo:18, copo:14 };
      var FILL_MFR = { none:0, talc:-0.12, sgf:-0.35, lgf:-0.50, caco3:-0.10, mica:-0.15 };
      var RUB_MFR = -0.25; // per 1% rubber
      var mfr = BASE_MFR[ppType] + (FILL_MFR[fillerType]||0)*fPct + RUB_MFR*rPct;
      mfr = clamp(mfr, 0.5, 120);

      t=clamp(t,10,200); f=clamp(f,20,300); i=clamp(i,20,800); h=clamp(h,60,160);
      var tBand=band(t,0.06), fBand=band(f,0.06), iBand=band(i,0.08), hBand=band(h,0.03), mBand=band(mfr,0.15);
      return {
        tensile: tBand[0].toFixed(0) + '‚Äì' + tBand[1].toFixed(0),
        tensileModulus: '‚Äî',
        flexural: fBand[0].toFixed(0) + '‚Äì' + fBand[1].toFixed(0),
        flexuralModulus: '‚Äî',
        izodRT: iBand[0].toFixed(0) + '‚Äì' + iBand[1].toFixed(0),
        izodN30: (iBand[0]*0.6).toFixed(0) + '‚Äì' + (iBand[1]*0.6).toFixed(0),
        charpyRT: (iBand[0]/100).toFixed(1) + '‚Äì' + (iBand[1]/100).toFixed(1),
        hdt: hBand[0].toFixed(0) + '‚Äì' + hBand[1].toFixed(0),
        mfr: mBand[0].toFixed(1) + '‚Äì' + mBand[1].toFixed(1)
      };
    }

    function calcPriceIndex(ppType, fillerType, fPct, rPct){
      // Evidence-informed cost factors (relative to base PP ~1.0‚Äì1.5 $/kg)
      var fillerCost={ none:0, caco3:0.3, talc:0.4, mica:0.8, sgf:1.9, lgf:2.3 };
      var rubberCF=2.2; var base= (ppType==='homo'?1.05:1.0);
      var ppPct = 100 - fPct - rPct; if(ppPct<20) return 'N/A';
      var total = (ppPct*base)+(fPct*(fillerCost[fillerType]||0))+(rPct*rubberCF); return (total/100).toFixed(2);
    }

    // ===== L/M/H tags =====
    var LEVEL_BANDS = {
      tensileStrength: { low:25, med:45 },
      tensileModulus:  { low:1500, med:3500 },
      flexuralStrength:{ low:40,  med:70  },
      flexuralModulus: { low:1500, med:4000 },
      izodImpactRT:    { low:50,  med:200 },
      izodImpactN30:   { low:20,  med:100 },
      charpyImpactRT:  { low:0.5, med:2.0 },
      mfr:             { low:5,   med:20  },
      hdt:             { low:80,  med:110 }
    };
    function extractNumbers(s){
      var out=[]; var cur='';
      for(var i=0;i<s.length;i++){
        var c=s[i];
        var isNum = (c>='0' && c<='9') || c==='.' || c==='-';
        if(isNum){ cur+=c; } else { if(cur){ var v=parseFloat(cur); if(!isNaN(v)) out.push(v); cur=''; } }
      }
      if(cur){ var v=parseFloat(cur); if(!isNaN(v)) out.push(v); }
      return out;
    }
    function parseMid(str){
      if(!str || typeof str !== 'string') return NaN;
      var nums = extractNumbers(str);
      if(!nums || !nums.length) return NaN;
      var first = nums[0]; var last = nums[nums.length-1];
      if(isNaN(last)) return first;
      return (first + last) / 2;
    }
    function levelOf(propKey, value){
      var b = LEVEL_BANDS[propKey];
      if(!b || isNaN(value)) return null;
      if(value < b.low) return 'low';
      if(value <= b.med) return 'medium';
      return 'high';
    }
    function levelSpan(level){
      if(!level) return '';
      var cls = level==='low'?'level-low':(level==='medium'?'level-medium':'level-high');
      return ' <span class="level ' + cls + '">' + level.toUpperCase() + '</span>';
    }
    function withLevel(propKey, valueStr){
      var mid = parseMid(valueStr);
      var lvl = levelOf(propKey, mid);
      return valueStr + levelSpan(lvl);
    }

    // ===== AI Material Advisor =====
    var gemBtn = document.getElementById('gemini-button');
    var promptInput = document.getElementById('prompt-input');
    var gemLoad = document.getElementById('gemini-loader');
    var gemOut = document.getElementById('gemini-result');
    gemBtn && gemBtn.addEventListener('click', async function(){
      var userPrompt = promptInput.value.trim(); if(!userPrompt){ gemOut.innerHTML='<p>Please enter your application requirements.</p>'; return; }
      gemLoad.style.display='block'; gemOut.innerHTML=''; gemBtn.disabled=true;
      var text = userPrompt.toLowerCase();
      try{
        // If you wire an API key above, this will call Gemini. Otherwise we go to fallback.
        var html = await callGemini('Recommend a PP compound for: "' + userPrompt + '". Format as HTML.', null); gemOut.innerHTML = html;
      }catch(e){
        var suggestion = 'PP Copo + Talc 20% for balanced stiffness/flow and moderate impact.';
        if(text.indexOf('bumper')>-1 || text.indexOf('impact')>-1 || text.indexOf('low temp')>-1 || text.indexOf('cold')>-1 || text.indexOf('notch')>-1){ suggestion = 'PP Copo + EPDM 10‚Äì15% + Talc 10% (high impact, better ‚àí30¬∞C).'; }
        if(text.indexOf('bracket')>-1 || text.indexOf('stiff')>-1 || text.indexOf('rigid')>-1 || text.indexOf('warp')>-1){ suggestion = 'PP Homo + SGF 20‚Äì30% (high stiffness, good HDT).'; }
        if(text.indexOf('structure')>-1 || text.indexOf('load')>-1 || text.indexOf('nvh')>-1 || text.indexOf('creep')>-1){ suggestion = 'PP Homo + LGF 20‚Äì30% (very high stiffness, creep resistance).'; }
        gemOut.innerHTML = '<h3>Suggested Direction (Heuristic)</h3><p>' + suggestion + '</p><p class="hint">(AI API not configured; local heuristic used.)</p>';
      }finally{ gemLoad.style.display='none'; gemBtn.disabled=false; }
    });

    // ===== Estimator =====
    var estBtn = document.getElementById('estimator-button');
    var estLoad = document.getElementById('estimator-loader');
    var estOut  = document.getElementById('estimator-result');
    var tipsBtn = document.getElementById('processing-tips-button');
    var tipsLoad= document.getElementById('processing-loader');
    var tipsOut = document.getElementById('processing-result');
    var useVerified = document.getElementById('use-verified');

    function estimateProperties(pp, filler, fPct, rPct, preferVerified){
      var data=null, usedVerified=false, usedFallback=false;
      if(preferVerified){ var ev = evidenceEstimate(pp, filler, fPct, rPct); if(ev){ data=ev; usedVerified=true; } }
      if(!data){
        var h = heuristicEstimate(pp, filler, fPct, rPct); usedFallback=true;
        data = { tensileStrength:h.tensile, tensileModulus:'‚Äî', flexuralStrength:h.flexural, flexuralModulus:'‚Äî', izodImpactRT:h.izodRT, izodImpactN30:h.izodN30, charpyImpactRT:h.charpyRT, mfr:h.mfr, hdt:h.hdt };
      }
      return { data:data, usedVerified:usedVerified, usedFallback:usedFallback };
    }

    estBtn && estBtn.addEventListener('click', function(){
      var pp = document.getElementById('pp-type-select').value;
      var filler = document.getElementById('filler-type-select').value;
      var fPct = parseFloat(document.getElementById('filler-content-input').value)||0;
      var rPct = parseFloat(document.getElementById('rubber-content-input').value)||0;
      if(fPct + rPct > 80){ estOut.innerHTML='<p>Error: Total filler and rubber content should not exceed 80%.</p>'; return; }
      var preferVerified = !!(useVerified && useVerified.checked);
      var res = estimateProperties(pp, filler, fPct, rPct, preferVerified);
      var data = res.data; var price = calcPriceIndex(pp, filler, fPct, rPct);

      var htmlRes = ''+
        '<table class="result-table"><tbody>'+
          '<tr><td>Tensile Strength (MPa)</td><td>' + withLevel('tensileStrength', (data.tensileStrength||'‚Äî')) + '</td></tr>'+
          '<tr><td>Tensile Modulus (MPa)</td><td>' + withLevel('tensileModulus', (data.tensileModulus||'‚Äî')) + '</td></tr>'+
          '<tr><td>Flexural Strength (MPa)</td><td>' + withLevel('flexuralStrength', (data.flexuralStrength||'‚Äî')) + '</td></tr>'+
          '<tr><td>Flexural Modulus (MPa)</td><td>' + withLevel('flexuralModulus', (data.flexuralModulus||'‚Äî')) + '</td></tr>'+
          '<tr><td>Izod Impact RT (J/m, notched)</td><td>' + withLevel('izodImpactRT', (data.izodImpactRT||'‚Äî')) + '</td></tr>'+
          '<tr><td>Izod Impact ‚àí30¬∞C (J/m, notched)</td><td>' + withLevel('izodImpactN30', (data.izodImpactN30||'‚Äî')) + '</td></tr>'+
          '<tr><td>Charpy Impact RT (kJ/m¬≤, notched)</td><td>' + withLevel('charpyImpactRT', (data.charpyImpactRT||'‚Äî')) + '</td></tr>'+
          '<tr><td>MFR (g/10 min)</td><td>' + withLevel('mfr', (data.mfr||'‚Äî')) + '</td></tr>'+
          '<tr><td>HDT @1.8 MPa (¬∞C)</td><td>' + withLevel('hdt', (data.hdt||'‚Äî')) + '</td></tr>'+
          '<tr class="price-row"><td>Relative Price Index</td><td>' + price + '</td></tr>'+
        '</tbody></table>';
      if(res.usedVerified){ htmlRes += (data._badge ? '<div style="margin-top:8px">' + data._badge + '</div>' : '<span class="badge verified">Verified data</span>'); }
      estOut.innerHTML = htmlRes;

      tipsBtn.style.display='inline-flex';
    });

    // Processing tips (AI or heuristic)
    var tipsBtnEl = document.getElementById('processing-tips-button');
    tipsBtnEl && tipsBtnEl.addEventListener('click', async function(){
      var ppType = document.getElementById('pp-type-select').value;
      var fillerType = document.getElementById('filler-type-select').value;
      var fillerContent = parseFloat(document.getElementById('filler-content-input').value)||0;
      var rubberContent = parseFloat(document.getElementById('rubber-content-input').value)||0;
      tipsLoad.style.display='block'; tipsOut.innerHTML=''; tipsBtnEl.disabled=true;
      try{
        var html = await callGemini('PP Type: ' + ppType + ', Filler: ' + fillerType + ' ' + fillerContent + '%, Rubber: ' + rubberContent + '%. Provide injection molding tips. Format as HTML list.', null);
        tipsOut.innerHTML = html; tipsOut.style.display='block';
      }catch(e){
        var melt = (ppType==='homo'?200:190) + '‚Äì' + (ppType==='homo'?230:220) + ' ¬∞C';
        var mold = '30‚Äì50 ¬∞C';
        var speed = fillerType==='lgf' ? 'Low‚ÄìMedium (to limit fiber breakage)' : (fillerType==='sgf' ? 'Medium' : 'Medium‚ÄìHigh');
        var hold = fillerType==='talc' || fillerType==='mica' ? 'Higher pack/hold to control shrink and warpage' : 'Standard';
        var txt = '<ul>'+
          '<li><b>Melt Temp:</b> ' + melt + '</li>'+
          '<li><b>Mold Temp:</b> ' + mold + '</li>'+
          '<li><b>Injection Speed:</b> ' + speed + '</li>'+
          '<li><b>Notes:</b> ' + hold + '; dry filler grades; vent adequately; increase back pressure for GF dispersion.</li>'+
        '</ul>';
        tipsOut.innerHTML = txt; tipsOut.style.display='block';
      }finally{ tipsLoad.style.display='none'; tipsBtnEl.disabled=false; }
    });

    // ===== Comparator =====
    var comparatorButton = document.getElementById('comparator-button');
    var comparatorLoader = document.getElementById('comparator-loader');
    var comparatorResultDiv = document.getElementById('comparator-result');

    function getComp(prefix){
      return {
        pp: document.getElementById(prefix+'-pp-type').value,
        filler: document.getElementById(prefix+'-filler-type').value,
        fPct: parseFloat(document.getElementById(prefix+'-filler-content').value)||0,
        rPct: parseFloat(document.getElementById(prefix+'-rubber-content').value)||0
      };
    }

    comparatorButton && comparatorButton.addEventListener('click', function(){
      comparatorLoader.style.display='block'; comparatorResultDiv.innerHTML=''; comparatorButton.disabled=true;
      try{
        var A = getComp('a'); var B = getComp('b');
        if(A.fPct + A.rPct > 80) throw new Error('Material A composition exceeds 80% additives.');
        if(B.fPct + B.rPct > 80) throw new Error('Material B composition exceeds 80% additives.');
        var preferVerified = !!(useVerified && useVerified.checked);
        var resA = estimateProperties(A.pp, A.filler, A.fPct, A.rPct, preferVerified);
        var resB = estimateProperties(B.pp, B.filler, B.fPct, B.rPct, preferVerified);
        var priceA = calcPriceIndex(A.pp, A.filler, A.fPct, A.rPct);
        var priceB = calcPriceIndex(B.pp, B.filler, B.fPct, B.rPct);
        var Adata = resA.data, Bdata = resB.data;
        var html = ''+
          '<table class="result-table">'+
          '<thead><tr><th>Property</th><th>Material A</th><th>Material B</th></tr></thead><tbody>'+
          '<tr><td>Tensile Strength (MPa)</td><td>' + withLevel('tensileStrength',(Adata.tensileStrength||'‚Äî')) + '</td><td>' + withLevel('tensileStrength',(Bdata.tensileStrength||'‚Äî')) + '</td></tr>'+
          '<tr><td>Tensile Modulus (MPa)</td><td>' + withLevel('tensileModulus',(Adata.tensileModulus||'‚Äî')) + '</td><td>' + withLevel('tensileModulus',(Bdata.tensileModulus||'‚Äî')) + '</td></tr>'+
          '<tr><td>Flexural Strength (MPa)</td><td>' + withLevel('flexuralStrength',(Adata.flexuralStrength||'‚Äî')) + '</td><td>' + withLevel('flexuralStrength',(Bdata.flexuralStrength||'‚Äî')) + '</td></tr>'+
          '<tr><td>Flexural Modulus (MPa)</td><td>' + withLevel('flexuralModulus',(Adata.flexuralModulus||'‚Äî')) + '</td><td>' + withLevel('flexuralModulus',(Bdata.flexuralModulus||'‚Äî')) + '</td></tr>'+
          '<tr><td>Izod Impact RT (J/m, notched)</td><td>' + withLevel('izodImpactRT',(Adata.izodImpactRT||'‚Äî')) + '</td><td>' + withLevel('izodImpactRT',(Bdata.izodImpactRT||'‚Äî')) + '</td></tr>'+
          '<tr><td>Izod Impact ‚àí30¬∞C (J/m, notched)</td><td>' + withLevel('izodImpactN30',(Adata.izodImpactN30||'‚Äî')) + '</td><td>' + withLevel('izodImpactN30',(Bdata.izodImpactN30||'‚Äî')) + '</td></tr>'+
          '<tr><td>Charpy Impact RT (kJ/m¬≤, notched)</td><td>' + withLevel('charpyImpactRT',(Adata.charpyImpactRT||'‚Äî')) + '</td><td>' + withLevel('charpyImpactRT',(Bdata.charpyImpactRT||'‚Äî')) + '</td></tr>'+
          '<tr><td>MFR (g/10 min)</td><td>' + withLevel('mfr',(Adata.mfr||'‚Äî')) + '</td><td>' + withLevel('mfr',(Bdata.mfr||'‚Äî')) + '</td></tr>'+
          '<tr><td>HDT @1.8 MPa (¬∞C)</td><td>' + withLevel('hdt',(Adata.hdt||'‚Äî')) + '</td><td>' + withLevel('hdt',(Bdata.hdt||'‚Äî')) + '</td></tr>'+
          '<tr class="price-row"><td>Relative Price Index</td><td>' + priceA + '</td><td>' + priceB + '</td></tr>'+
          '</tbody></table>';
        comparatorResultDiv.innerHTML = html;
      }catch(err){
        comparatorResultDiv.innerHTML = '<p>Could not compare materials. ' + err.message + '</p>';
      }finally{
        comparatorLoader.style.display='none'; comparatorButton.disabled=false;
      }
    });

    // ===== Self tests =====
    (function runSelfTests(){
      try{
        console.assert(parseMid('100‚Äì200')===150, 'parseMid range');
        console.assert(levelOf('izodImpactRT',150)==='medium','izod 150 MEDIUM');
        console.assert(levelOf('charpyImpactRT',2.6)==='high','charpy 2.6 HIGH');
        var t = withLevel('tensileStrength','30‚Äì40 MPa'); console.assert(t.toUpperCase().indexOf('LEVEL')>-1,'withLevel attaches tag');
        console.log('[PP Guide] Self-tests passed');
      }catch(e){ console.warn('[PP Guide] Self-tests need attention', e); }
    })();
  </script>
</body>
</html>
